function exportMAL(e, t) {
  if (
    "undefined" != typeof turnstile &&
    "function" == typeof turnstile.getResponse
  ) {
    var n = "",
      o = "text/xml",
      i = Date.now() + "_Animix.xml",
      r = gID("reportinput");
    "JSON" === t &&
      ((n = "&usejson=yes"),
      (o = "text/json"),
      (i = Date.now() + "_Animix.json"));
    var s = r.value;
    if ("" === s)
      return (
        (r.style.borderColor = "red"),
        shownotif("Please input your username"),
        void setTimeout(() => {
          r.style.borderColor = "";
        }, 1e3)
      );
    var a = e,
      l = turnstile.getResponse();
    if ("string" != typeof l || l.length < 10)
      shownotif("Please check the captcha");
    else {
      turnstile.reset(),
        a.setAttribute("onClick", ""),
        (a.style.opacity = "0.5"),
        (a.style.cursor = "default"),
        (a.innerHTML = "Processing...");
      var u = new XMLHttpRequest();
      u.open("POST", "/api/usr"),
        u.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"),
        (u.timeout = 15e3),
        (u.onloadend = function () {
          if (200 == u.status) {
            a.innerHTML = "Done";
            var e = new Blob([u.response], { type: o }),
              n = document.createElement("a");
            (n.style.display = "none"), document.body.appendChild(n);
            var r = window.URL.createObjectURL(e);
            (n.href = r),
              (n.download = i),
              n.click(),
              setTimeout(function () {
                window.URL.revokeObjectURL(r);
              }, 1e4);
          } else {
            var s = "Network error";
            isJson(u.response) && (s = JSON.parse(u.response).error),
              shownotif(s),
              (a.innerHTML = s),
              setTimeout(function () {
                a.setAttribute("onClick", "exportMAL(this, '" + t + "');"),
                  (a.style.opacity = "1"),
                  (a.style.cursor = "pointer"),
                  (a.innerHTML = "Download " + t);
              }, 3e3);
          }
        }),
        u.send(
          "CFtoken=" +
            l +
            n +
            "&username=" +
            s +
            "&malexport=LLKiM0TG2w1yHbH5DxMI9egajDKNUC4M0"
        );
    }
  } else
    shownotif(
      "Captcha didn't load yet, your extension may cause the problem",
      4e3
    );
}
document.addEventListener("DOMContentLoaded", function () {
  checkloginhome(), console.log("tech info : https://animixplay.to/about.html");
});
var exportLoaded = !1;
function showExport() {
  if ("" === gClass("cf-turnstile")[0].innerHTML) {
    var e = document.createElement("script");
    (e.src = "https://challenges.cloudflare.com/turnstile/v0/api.js"),
      document.body.appendChild(e);
  }
  if (exportLoaded)
    (gID("reportform").style.display = "block"),
      (gID("reportform").style.animationName = "notifin");
  else {
    var t = document.createElement("div");
    if (
      ((t.innerHTML =
        '<i class="closebtn glyphicon glyphicon-remove" id="reportclose" onclick="removeExport()"></i>Export Data\n        <div style="font-size: 12px;text-align: left;padding-left: 13px;margin-bottom: -8px;margin-top: 5px;">Username</div>\n        <input class="logininput" id="reportinput" type="text" placeholder="Username" style="height: unset;">\n        <div id="usernamehint" style="font-size:10px;color:gray;">if you forget username, find in your browser history, your username was in the url when you visit user panel</div>\n        <div class="cf-turnstile" data-theme="dark" data-sitekey="0x4AAAAAAAAzJXW2FyjHM1O6"></div>\n        <div class="changepassbtn" style="margin-bottom:10px;font-size:13px;" onClick="exportMAL(this, \'XML\');">Download XML</div>\n        <div class="changepassbtn" style="margin-bottom:10px;font-size:13px;" onClick="exportMAL(this, \'JSON\');">Download JSON</div>'),
      t.setAttribute("id", "reportform"),
      (t.style.cssText = "display:block;animation-name:notifin"),
      document.body.appendChild(t),
      (exportLoaded = !0),
      "" !== username)
    ) {
      gID("usernamehint").remove();
      var n = gID("reportinput");
      (n.value = username), (n.style.opacity = "0.7");
    }
  }
  var o = gID("coverlight");
  (o.style.backgroundColor = "rgba(10,10,10,.5)"),
    (o.style.zIndex = "99"),
    fadeIn(o),
    o.addEventListener("click", removeExport);
}
function removeExport() {
  var e = gID("reportform");
  (e.style.animationName = "notifout"),
    setTimeout(function () {
      e.style.display = "none";
    }, 400);
  var t = gID("coverlight");
  t.removeEventListener("click", removeExport),
    fadeOut(t),
    setTimeout(function () {
      (t.style.backgroundColor = ""), (t.style.zIndex = "8");
    }, 400);
}
function checkloginhome() {
  var e = !1;
  if (isStorage("localStorage")) {
    var t = localStorage.getItem("usrCache");
    "refresh" === t
      ? (e = !0)
      : "logout" === t
      ? (e = !1)
      : null !== t && isJson(t)
      ? onLoggedin((t = JSON.parse(t)))
      : (e = !0);
  } else e = !0;
  if (e) {
    var n = new XMLHttpRequest();
    n.open("POST", "/api/usr"),
      n.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"),
      (n.timeout = 15e3),
      (n.onloadend = function () {
        if (200 === n.status && isJson(n.responseText)) {
          var e = JSON.parse(n.responseText);
          if (e.hasOwnProperty("no") && "ok" === e.no)
            isStorage("localStorage") &&
              localStorage.setItem("usrCache", "logout");
          else if (e.hasOwnProperty("username")) {
            if (isStorage("localStorage")) {
              var t = JSON.stringify(e);
              localStorage.setItem("usrCache", t);
            }
            onLoggedin(e);
          }
        }
      }),
      n.send("cek=y");
  }
}
var username = "";
function onLoggedin(e) {
  (username = e.username),
    exportLoaded &&
      (gID("usernamehint").remove(), (gID("reportinput").value = username));
}
var notFoundID = {},
  gID = function (e) {
    var t = document.getElementById(e);
    return (
      null === t &&
        (void 0 === notFoundID[e]
          ? ((t = document.createElement("div")), (notFoundID[e] = t))
          : (t = notFoundID[e])),
      t
    );
  },
  notFoundClass = {},
  gClass = function (e) {
    var t = document.getElementsByClassName(e);
    return (
      void 0 === t[0] &&
        (void 0 === notFoundClass[e]
          ? ((t = [document.createElement("div")]), (notFoundClass[e] = t))
          : (t = notFoundClass[e])),
      t
    );
  },
  notifDisplayed = !1;
function shownotif(e, t = 1700) {
  var n = setInterval(function () {
    if (!notifDisplayed) {
      notifDisplayed = !0;
      var o = gID("notifiaction");
      (o.innerHTML = e),
        (o.style.display = "block"),
        (o.style.animationName = "notifin"),
        setTimeout(function () {
          o.style.animationName = "notifout";
        }, t + 400),
        setTimeout(function () {
          (o.style.display = "none"), (notifDisplayed = !1);
        }, t + 800),
        clearInterval(n);
    }
  }, 50);
}
function fadeOut(e) {
  (e.style.opacity = 1),
    (function t() {
      (e.style.opacity -= 0.05) < 0
        ? (e.style.display = "none")
        : requestAnimationFrame(t);
    })();
}
function fadeIn(e) {
  (e.style.opacity = 0),
    (e.style.display = "block"),
    (function t() {
      var n = parseFloat(e.style.opacity);
      (n += 0.05) > 1 || ((e.style.opacity = n), requestAnimationFrame(t));
    })();
}
function isStorage(e) {
  try {
    var t = window[e],
      n = "__storage_test__";
    return t.setItem(n, n), t.removeItem(n), !0;
  } catch (e) {
    return !1;
  }
}
function isJson(e) {
  try {
    JSON.parse(e);
  } catch (e) {
    return !1;
  }
  return !0;
}
